---
title: "Round by Round Seed Distribution in NCAA Tournament"
author: "John Kane"
date: '2019-04-02'
slug: round-by-round-seed-distribution-in-ncaa-tournament
tags:
- basketball
- March Madness
- R
categories:
- basketball
- March Madness
- R
---

Working backwards through the NCAA tournament

Most years filling out my bracket I work "forwards"

The traditional office pool works differently than the Kaggle competition for March Madness. In the office pool you typically choose the winner of each game and accumulate an increasing number of points for each correct pick. In the Kaggle competition you compete by determining a probabilistic evaluation of every possible matchup, and are then judged on how well calibrated the outcome was to your forecast. 

You are not credited for predicting a correct Elite Eight matchup, but by whether or not the matchup that occurs you have a good forecast for.


## Data

The data comes from the Kaggle competition for March Madness[^1]. I didn't submit an entry to the contest but used the data for this analysis.

```{r}
library(tidyverse)
seeds <- read_csv("/home/john/basketball/march_madness/2019/data/DataFiles/NCAATourneySeeds.csv")
results <- read_csv("/home/john/basketball/march_madness/2019/data/DataFiles/NCAATourneyCompactResults.csv")
```


```{r}
results_w_seeds <- 
  inner_join(results %>% select(Season,WTeamID,LTeamID),
             seeds %>% mutate(WSeed = str_sub(Seed,2,3)),
             by = c('Season','WTeamID' = 'TeamID')) %>%
  inner_join(.,
             seeds %>% mutate(LSeed = str_sub(Seed,2,3)),
             by = c('Season','LTeamID' = 'TeamID')) %>%
  mutate(matchup = paste0(pmin(WSeed,LSeed),"-",pmax(WSeed,LSeed))) %>%
  select(Season,WSeed,LSeed,matchup)
```



#### Determining which round each game was

```{r}
season_first_tourney_day <-
results %>%
  group_by(Season) %>%
  summarise(first_day = min(DayNum))

results_tourney_day <-
  results %>%
  inner_join(season_first_tourney_day, by = 'Season') %>%
  mutate(days_since_first = DayNum - first_day)
```


```{r}
table(results_tourney_day$days_since_first)
```


```{r}
results_tourney_day %>%
  group_by(Season) %>%
  summarise(count = n_distinct(days_since_first))
```


```{r}
results_tourney_day <-
  results_tourney_day%>%
  mutate(round  = case_when(
    Season %in% c(1985:2000) & days_since_first %in% c(0,1)  ~ 1,
    Season %in% c(1985:2000) & days_since_first %in% c(2,3)  ~ 2,
    Season %in% c(1985:2000) & days_since_first %in% c(7,8)  ~ 3,
    Season %in% c(1985:2000) & days_since_first %in% c(9,10) ~ 4,
    Season %in% c(1985:2000) & days_since_first %in% c(16)   ~ 5,
    Season %in% c(1985:2000) & days_since_first %in% c(18)   ~ 6,
    Season %in% c(2001:2010) & days_since_first %in% c(0)    ~ 0,
    Season %in% c(2001:2010) & days_since_first %in% c(2,3)  ~ 1,
    Season %in% c(2001:2010) & days_since_first %in% c(4,5)  ~ 2,
    Season %in% c(2001:2010) & days_since_first %in% c(9,10) ~ 3,
    Season %in% c(2001:2010) & days_since_first %in% c(11,12)~ 4,
    Season %in% c(2001:2010) & days_since_first %in% c(18)   ~ 5,
    Season %in% c(2001:2010) & days_since_first %in% c(20)   ~ 6,
    Season %in% c(2011:2018) & days_since_first %in% c(0,1)  ~ 0,
    Season %in% c(2011:2018) & days_since_first %in% c(2,3)  ~ 1,
    Season %in% c(2011:2018) & days_since_first %in% c(4,5)  ~ 2,
    Season %in% c(2011:2018) & days_since_first %in% c(9,10) ~ 3,
    Season %in% c(2011:2018) & days_since_first %in% c(11,12)~ 4,
    Season %in% c(2011:2018) & days_since_first %in% c(18)   ~ 5,
    Season %in% c(2011:2018) & days_since_first %in% c(20)   ~ 6,
    TRUE ~ NA_real_))

```


```{r}
results_w_seeds <-
  results_tourney_day %>% select(Season,WTeamID,LTeamID,round) %>%
  inner_join(.,
             seeds %>% mutate(WSeed = str_sub(Seed,2,3)),
             by = c('Season','WTeamID' = 'TeamID')) %>%
  inner_join(.,
             seeds %>% mutate(LSeed = str_sub(Seed,2,3)),
             by = c('Season','LTeamID' = 'TeamID')) %>%
  select(Season,WSeed,LSeed,round)
```


## Champion

```{r}
results_w_seeds %>%
  filter(round == 6) %>%
  group_by(WSeed) %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(pct = count/sum(count))
```


#1 Seeds have won the tournament 62% of the time! 

## Championship Game

```{r}
results_w_seeds %>%
  filter(round == 5) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  mutate(championshipgame = paste0(`01`,`02`,`03`,`04`,`05`,`06`,`07`,`08`)) %>%
  group_by(championshipgame) %>%
  summarise(count = n()) %>%
  mutate(pct = count/sum(count)) %>%
  arrange(desc(count))
```

The most likely matchup is between a #1 and a #2 seed, followed by two #1 seeds. 


## Final Four

```{r}
results_w_seeds %>%
  filter(round == 4) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  mutate(finalfour = paste0(`01`,`02`,`03`,`04`,`05`,`06`,`07`,`08`,`09`,`10`,`11`)) %>%
  group_by(finalfour) %>%
  summarise(count = n()) %>%
  mutate(pct = count/sum(count)) %>%
  arrange(desc(count))
```

There are 34 years worth of data and 25 distinct distributions of final four teams. I think at this point it becomes difficult to lean one way or another, as the most common Final Four happens less than 10% of the time.

An alternative would be to look at the average number of seeds that make it to the final four. 

```{r}
results_w_seeds %>%
  filter(round == 4) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  ungroup() %>%
  select(-Season) %>%
  summarise_if(is.numeric,mean,na.rm=TRUE) 
```

So on average there are:
* 1.6 1 seeds
* 0.8 2 seeds
* 0.5 3 seeds
* 0.4 4 seeds
* 0.2 5 seeds
* 0.1 6 seeds
* 0

So any recommendations would be to choose at least 1 and probably 2 #1 seeds, 1 #2 seed, and then pick from one of the three or four seeds. 



## Elite Eight

```{r}
results_w_seeds %>%
  filter(round == 3) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  mutate(sweet16 = paste0(`01`,`02`,`03`,`04`,`05`,`06`,`07`,`08`,`09`,`10`,`11`,`12`)) %>%
  group_by(sweet16) %>%
  summarise(count = n()) %>%
  mutate(pct = count/sum(count)) %>%
  arrange(desc(count))
```



```{r}
results_w_seeds %>%
  filter(round == 3) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  ungroup() %>%
  select(-Season) %>%
  summarise_if(is.numeric,mean,na.rm=TRUE) 
```



## Sweet 16

```{r}
results_w_seeds %>%
  filter(round == 2) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  mutate(sweet16 = paste0(`01`,`02`,`03`,`04`,`05`,`06`,`07`,`08`,`09`,`10`,`11`,`12`,`13`,`14`,`15`)) %>%
  group_by(sweet16) %>%
  summarise(count = n()) %>%
  mutate(pct = count/sum(count)) %>%
  arrange(desc(count))
```


```{r}
results_w_seeds %>%
  filter(round == 2) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  ungroup() %>%
  select(-Season) %>%
  summarise_if(is.numeric,mean,na.rm=TRUE) 
```


## Round of 32

```{r}
results_w_seeds %>%
  filter(round == 1) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  mutate(roundof32 = paste0(`01`,`02`,`03`,`04`,`05`,`06`,`07`,`08`,`09`,`10`,`11`,`12`,`13`,`14`,`15`,`16`)) %>%
  group_by(roundof32) %>%
  summarise(count = n()) %>%
  mutate(pct = count/sum(count)) %>%
  arrange(desc(count))
```



```{r}
results_w_seeds %>%
  filter(round == 1) %>%
  group_by(Season,WSeed) %>%
  summarise(count = n()) %>%
  spread(key = WSeed, value = count, fill = 0) %>%
  ungroup() %>%
  select(-Season) %>%
  summarise_if(is.numeric,mean,na.rm=TRUE) 
```


## 2019 Results

### Round of 32

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|4.0|3.8|3.4|3.2|2.6|2.5|2.5|2.0|2.0|1.5 |1.5 | 1.4|0.8 |0.6 |0.2 | 0.0|
| 2019   | 4 | 4 | 4 | 3 | 1 | 3 | 1 | 0 | 4 | 3  |  1 |  3 |  1 |  0 |  0 | 0  |



### Sweet 16

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|3.4|2.5|2.1|1.9|1.4|1.2|0.8|0.4|0.2|0.7 |0.6 | 0.6|0.2 | 0.1| 0.0|0.0 |
| 2019   | 4 | 4 | 4 | 2 | 1 | 0 | 0 | 0 | 0 | 0  | 0  | 0  |  0 |  0 |  0 |  0 |

### Elite 8

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|3.4|2.5|2.1|1.9|1.4|1.2|0.8|0.4|0.2|0.7 |0.6 | 0.6|0.2 | 0.1| 0.0|0.0 |
| 2019   | 4 | 4 | 4 | 2 | 1 | 0 | 0 | 0 | 0 | 0  | 0  | 0  |  0 |  0 |  0 |  0 |

### Final Four

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|3.4|2.5|2.1|1.9|1.4|1.2|0.8|0.4|0.2|0.7 |0.6 | 0.6|0.2 | 0.1| 0.0|0.0 |
| 2019   | 4 | 4 | 4 | 2 | 1 | 0 | 0 | 0 | 0 | 0  | 0  | 0  |  0 |  0 |  0 |  0 |

### Championship Game

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|3.4|2.5|2.1|1.9|1.4|1.2|0.8|0.4|0.2|0.7 |0.6 | 0.6|0.2 | 0.1| 0.0|0.0 |
| 2019   | 4 | 4 | 4 | 2 | 1 | 0 | 0 | 0 | 0 | 0  | 0  | 0  |  0 |  0 |  0 |  0 |


### Champion

| Seed   | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 |
|--------|---|---|---|---|---|---|---|---|---|----|----|----|----|----|----|----|
| Average|3.4|2.5|2.1|1.9|1.4|1.2|0.8|0.4|0.2|0.7 |0.6 | 0.6|0.2 | 0.1| 0.0|0.0 |
| 2019   | 4 | 4 | 4 | 2 | 1 | 0 | 0 | 0 | 0 | 0  | 0  | 0  |  0 |  0 |  0 |  0 |



## Closing Thoughts

The first two rounds of the tournament were chalky[^3], which lends itself nicely to using long run averages, as over that timeframe the higher seeds are generally better teams and happen to win. 


I thought that 

The more difficult piece to this is the logical extension of knowing how many of each seed are likely to advance to the next
round. For example, I know there are on average going to be 2 1 seeds in the Final Four, which 2 1 seeds do I pick?

My approach this year was to use the pre tournament probabilities from 538[^2]. So I selected the 1 seed with the highest pre-tournament probability of winning the championship (Duke, ~28%)



[^1]:https://www.kaggle.com/c/mens-machine-learning-competition-2019
[^2]:https://projects.fivethirtyeight.com/2019-march-madness-predictions/
[^3]:https://www.cbssports.com/college-basketball/news/march-madness-2019-chalk-has-ruled-the-ncaa-tournament-so-far-but-that-sets-up-what-could-be-a-great-sweet-16/